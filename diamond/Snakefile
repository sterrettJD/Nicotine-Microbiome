directories = ["testdiamond"]
sampleids = ["SRR9641933"]
lanes = [1,2]
"""
def get_forward_paths(directory):
    contents = os.listdir(directory)
    # SRA gives in format of Project/Sample/Sample_1.fastq and Project/Sample/Sample_2.fastq
    # for forward and reverse reads, respectively
    forward_paths = [os.path.join(directory, content, content+"_1.fastq") for content in contents]
    return forward_paths


def get_reverse_paths(directory):

    contents = os.listdir(directory)
    
    reverse_paths = [os.path.join(directory, content, content+"_2.fastq")) for content in contents]
    return reverse_paths
"""
rule all:
    input: 
        expand("../testdiamond/{sampleid}/{sampleid}.assembled.fastq", sampleid=sampleids),
        expand("../testdiamond/{sampleid}/{sampleid}.discarded.fastq", sampleid=sampleids),
        expand("../testdiamond/{sampleid}/{sampleid}.unassembled.forward.fastq", sampleid=sampleids),
        expand("../testdiamond/{sampleid}/{sampleid}.unassembled.reverse.fastq", sampleid=sampleids),
        expand("../testdiamond/{sampleid}/diamond_results_{sampleid}.txt", sampleid=sampleids)

"""
    input:
        expand("../{directory}/{sample}/whatthisdid.txt", 
        directory=directories,
        sample=sampleids, 
        lane=lanes)
"""
rule merge_reads:
    input:
        "../testdiamond/{sampleid}/{sampleid}_1.fastq",
        "../testdiamond/{sampleid}/{sampleid}_2.fastq",
    output:
        "../testdiamond/{sampleid}/{sampleid}.assembled.fastq",
        "../testdiamond/{sampleid}/{sampleid}.discarded.fastq",
        "../testdiamond/{sampleid}/{sampleid}.unassembled.forward.fastq",
        "../testdiamond/{sampleid}/{sampleid}.unassembled.reverse.fastq"
    shell:
        " ~/tools/pear/src/pear -f ../testdiamond/{wildcards.sampleid}/{wildcards.sampleid}_1.fastq -r ../testdiamond/{wildcards.sampleid}/{wildcards.sampleid}_2.fastq -o ../testdiamond/{wildcards.sampleid}/{wildcards.sampleid}"

rule run_diamond:
    input:
        "../testdiamond/{sampleid}/{sampleid}.assembled.fastq"
    output:
        "../testdiamond/{sampleid}/diamond_results_{sampleid}.txt"
    shell:
        "diamond blastx --db ../database-building/uniprot-nicotine-db.dmnd -q ../testdiamond/{wildcards.sampleid}/{wildcards.sampleid}.assembled.fastq > ../testdiamond/{wildcards.sampleid}/diamond_results_{wildcards.sampleid}.txt" 